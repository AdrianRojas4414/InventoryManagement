<div class="layout">
  <app-sidebar></app-sidebar>

  <main>
    <header class="header">
      <div class="header-text">
        <h1>Gestión de Usuarios</h1>
        <h2>Administra empleados, asigna roles y controla accesos</h2>
      </div>
      <div class="actions">
        <button class="add" (click)="toggleForm()">+ Agregar Usuario</button>
      </div>
    </header>

    <!-- MODAL: FORMULARIO DE USUARIO -->
    <div class="modal-backdrop" *ngIf="showForm">
      <div class="form-card">
        <h3>Registrar nuevo usuario</h3>
        <form (ngSubmit)="createUser()" #userForm="ngForm" novalidate>
          <div class="form-grid">
            <!-- Usuario -->
            <div class="form-group" [class.invalid]="username.invalid && username.touched">
              <label>Usuario *</label>
              <input
                type="text"
                placeholder="Ej: jdoe"
                name="username"
                required
                [(ngModel)]="newUser.username"
                #username="ngModel"
              />
              <small *ngIf="username.invalid && username.touched">Campo obligatorio</small>
            </div>
            <!-- Nombre -->
            <div class="form-group" [class.invalid]="firstName.invalid && firstName.touched">
              <label>Nombre *</label>
              <input
                type="text"
                placeholder="Ej: Juan"
                name="firstName"
                required
                [(ngModel)]="newUser.firstName"
                #firstName="ngModel"
              />
              <small *ngIf="firstName.invalid && firstName.touched">Campo obligatorio</small>
            </div>

            <!-- Apellido -->
            <div class="form-group" [class.invalid]="lastName.invalid && lastName.touched">
              <label>Apellido *</label>
              <input
                type="text"
                placeholder="Ej: Pérez"
                name="lastName"
                required
                [(ngModel)]="newUser.lastName"
                #lastName="ngModel"
              />
              <small *ngIf="lastName.invalid && lastName.touched">Campo obligatorio</small>
            </div>

            <!-- Segundo Apellido -->
            <div class="form-group">
              <label>Segundo Apellido</label>
              <input
                type="text"
                placeholder="Ej: Rodríguez"
                name="secondLastName"
                [(ngModel)]="newUser.secondLastName"
              />
            </div>

            <!-- Rol -->
            <div class="form-group" [class.invalid]="role.invalid && role.touched">
              <label>Rol *</label>
              <select
                name="role"
                required
                [(ngModel)]="newUser.role"
                #role="ngModel"
              >
                <option value="">Seleccione un rol</option>
                <option value="User">Usuario</option>
                <option value="Employee">Empleado</option>
                <option value="Admin">Administrador</option>
              </select>
              <small *ngIf="role.invalid && role.touched">Campo obligatorio</small>
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="cancel" (click)="toggleForm()">Cancelar</button>
            <button type="submit" class="save" [disabled]="!userForm.valid">
              Guardar Usuario
            </button>
          </div>
        </form>

      </div>
    </div>

    <!-- TABLA DE USUARIOS -->
    <section class="table-container card">
      <table class="custom-table">
        <thead>
          <tr>
            <th>Usuario</th>
            <th>Nombre</th>
            <th>Apellido</th>
            <th>Rol</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let u of users">
            <td>{{ u.username }}</td>
            <td>{{ u.firstName }}</td>
            <td>{{ u.lastName }}</td>
            <td>
              <span
                class="badge"
                [ngClass]="{
                  'badge-admin': u.role === 'Admin',
                  'badge-employee': u.role === 'Employee',
                  'badge-user': u.role === 'User'
                }"
              >
                {{ u.role === 'Admin' ? 'Administrador' : (u.role === 'Employee' ? 'Empleado' : 'Usuario') }}
              </span>
            </td>
            <td class="actions">
              <button class="cancel" (click)="deleteUser(u.id)">Eliminar</button>
              <button class="add" (click)="updateRole(u, 'Admin')">Hacer Administrador</button>
              <button class="add" (click)="updateRole(u, 'User')">Hacer Usuario</button>
            </td>
          </tr>
        </tbody>
      </table>
    </section>
  </main>
</div>
